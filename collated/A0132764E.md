# A0132764E
###### src\app\logic\command\CommandSearch.java
``` java
	public CommandSearch() {
		super();
		this.setCommandType(CommandType.SEARCH);
	}
	
```
###### src\app\logic\command\CommandSearch.java
``` java
	@Override
	public ViewState execute(ViewState previousViewState) {
		LogHelper.getInstance().getLogger().info("Executing CommandSearch object.");

		this.previousViewState = new ViewState(previousViewState);
		ViewState viewState = new ViewState();
		TaskList master = CommandController.getInstance().getMasterTaskList();
		TaskList retrievedTaskList = master.getTaskListByCompletion(false);

		LogHelper.getInstance().getLogger()
				.info("\nContent: " + this.getContent() + "\nPriority: " + this.getPriority() + "\nStart: "
						+ this.getStartDate() + "\nEnd: " + this.getEndDate() + "\nType: " + this.getDisplayType());

		try {
			if (this.getDisplayType() == DisplayType.ALL) {
				retrievedTaskList = master;
			} else if (this.getDisplayType() == DisplayType.COMPLETED) {
				retrievedTaskList = master.getTaskListByCompletion(true);
			} 

			List<Predicate<Task>> predicates = new ArrayList<Predicate<Task>>();
			if (!this.getContent().isEmpty()) {
				predicates.add(Predicates.keywordMatches(this.getContent()));
			}
			if (this.getPriority() != null) {
				predicates.add(Predicates.priorityEquals(this.getPriority()));
			}
			if (this.getStartDate() != null && this.getEndDate() != null) {
				predicates.add(Predicates.betweenDates(this.getStartDate(), this.getEndDate()));
			} else if (this.getEndDate() != null) {
					predicates.add(Predicates.endDateBefore(this.getEndDate()));
			} else if (this.getStartDate() != null) {
					predicates.add(Predicates.startDateAfter(this.getStartDate()));
			}

			
			TaskList results = retrievedTaskList.search(predicates);
			
			viewState.setTaskList(results);
			viewState.setHeader(ViewConstants.HEADER_SEARCH);
			
			viewState.setStatus(StatusType.SUCCESS,
					String.format(ViewConstants.MESSAGE_SEARCH, results.getTaskList().size()));
			
			if (predicates.isEmpty() && this.getDisplayType() == null){
				viewState.setStatus(StatusType.SUCCESS,ViewConstants.ERROR_SEARCH_NO_PARAMETER);
			}
			this.setExecuted(true);
		} catch (Exception e) {
			LogHelper.getInstance().getLogger().severe("Error: "+e.getMessage());
			viewState.setStatus(StatusType.ERROR, String.format(ViewConstants.ERROR_SEARCH, this.getContent()));
		}
		
		return viewState;
	}
	
	//TODO: Kenny/Benjamin?
	@Override
	public ViewState undo() {
		if (!isExecuted()) {
			return new ViewState();
		}

		return previousViewState;
	}
}
```
###### src\app\model\CommandList.java
``` java
public class CommandList {
	ArrayList<String> commandList;
	int index;

	public CommandList() {
		commandList = new ArrayList<String>();
		index = -1;
	}
	
	public void add(String cmd) {
		commandList.add(cmd);
		reset();
	}
	
	//decrements index and returns command (String)
	public String prev() {
		index--;
		if (isValidIndex(index)) {
			return commandList.get(index);
		} else {
			index = 0;
			return "";
		}
	}
	
	public String next() {
		index++;
		if (isValidIndex(index)) {
			return commandList.get(index);
		} else {
			index = commandList.size();
			return "";
		}
	}
	
	public void reset() {
		index = commandList.size();
	}
	
	private boolean isValidIndex(int index) {
		return (index >= 0 && index < commandList.size());
	}
}
```
###### src\app\model\TaskList.java
``` java
	public TaskList search(List<Predicate<Task>> predicates) {
		Predicate<Task> query = compositePredicate(predicates);
		TaskList results = new TaskList();
		
		// filter the task list using the predicates
		// for each result, add it to the results list
		taskList.stream().filter(query).forEach(t -> results.addTask(t));
		return results;
	}

```
###### src\app\model\TaskList.java
``` java
	private Predicate<Task> compositePredicate(List<Predicate<Task>> predicates) {
		return predicates.stream().reduce(t -> true, Predicate::and);
	}
}
```
###### src\app\util\Predicates.java
``` java
	/**
	 * Predicate<Task> for specified end before date
	 * 
	 * @param end The end time used for match
	 * @return Predicate<Task> that ends before specified date
	 */
	public static Predicate<Task> endDateBefore(LocalDateTime end) {
		return t -> (t.getEndDate() != null) ? (t.getEndDate().isBefore(end) || t.getEndDate().isEqual(end)) : false;
	}
	
```
###### src\app\util\Predicates.java
``` java
	/**
	 * Predicate<Task> for specified start after date
	 * 
	 * @param start The start time used for match
	 * @return Predicate<Task> that starts after specified date
	 */
	public static Predicate<Task> startDateAfter(LocalDateTime start) {
		return t -> (t.getEndDate() != null) ? (t.getEndDate().isAfter(start) || t.getEndDate().isEqual(start)) : false;
	}

```
###### src\app\util\Predicates.java
``` java
	/**
	 * Predicate<Task> for specified start and end time
	 * 
	 * @param start The start time of task 
	 * @param end The end time of task 
	 * @return Predicate<Task> that falls between specified start and end dates
	 */
	public static Predicate<Task> betweenDates(LocalDateTime start, LocalDateTime end) {
		return t -> (t.getStartDate() != null
				|| t.getEndDate() != null)
						? (((t.getStartDate() != null)
								? (t.getStartDate().isEqual(start) || t.getStartDate().isAfter(start))
								: true)
								&& ((t.getEndDate() != null)
										? (t.getEndDate().isEqual(end)
												|| (t.getEndDate().isBefore(end) && t.getEndDate().isAfter(start)))
										: true))
						: false;

	}

```
###### src\app\util\Predicates.java
``` java
	/**
	 * Predicate<Task> for specified priority
	 * 
	 * @param priority The Priority used for match
	 * @return Predicate<Task> with specified priority
	 */
	public static Predicate<Task> priorityEquals(Priority priority) {
		return t -> (t.getPriority() != null)
				? (t.getPriority().toString().toLowerCase().equalsIgnoreCase(priority.toString().toLowerCase()))
				: false;
	}

```
###### src\app\util\Predicates.java
``` java
	/**
	 * Predicate<Task> for keyword matches
	 * 
	 * @param keyword The keyword used for match
	 * @return Predicate<Task> with specified keyword
	 */
	public static Predicate<Task> keywordMatches(String keyword) {
		// return t -> t.getName().toLowerCase().matches(".*\\b" +
		// keyword.toLowerCase() + "\\b.*");
		return t -> t.getName().toLowerCase().contains(keyword.toLowerCase());
	}
}
```
###### src\tests\PredicatesTest.java
``` java
	// WIP
	@Test
	public void testPredicates() {
		//building test case
		String input = "add eat sandwich priority high";
		Command cmd = CommandController.getInstance().createCommand(input);

		List<Predicate<Task>> predicates = new ArrayList<Predicate<Task>>();
		predicates.add(Predicates.keywordMatches(cmd.getContent()));
		assertFalse(predicates.isEmpty());
		
		//more?
	}
}
```
